<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Mimic by rackerlabs</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Mimic</h1>
        <h2>An API mock service</h2>

        <section id="downloads">
          <a href="https://github.com/rackerlabs/mimic/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/rackerlabs/mimic/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/rackerlabs/mimic" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="mimic" class="anchor" href="#mimic" aria-hidden="true"><span class="octicon octicon-link"></span></a>MIMIC</h1>

<p>Mimic is an API-compatible mock service for  <strong>Openstack Compute</strong> and <strong>Rackspace's implementation of Identity and Cloud Load balancers</strong>. It is backed by in-memory data structure rather than a potentially expensive database.</p>

<p>Mimic helps with:</p>

<ul>
<li>fast set-up</li>
<li>instant response</li>
<li>cost efficient</li>
<li>enables offline development</li>
<li>enables ability to test unusual behaviors/errors of an api</li>
<li>acts as a central repository for mocked responses from services</li>
</ul>

<h3>
<a id="quick-start" class="anchor" href="#quick-start" aria-hidden="true"><span class="octicon octicon-link"></span></a>Quick start</h3>

<p>The fastest way to install and start Mimic is:</p>

<pre><code>pip install mimic
twistd -n mimic
</code></pre>

<p>You can test the server started successfully by sending this request and checking for the
welcome message:</p>

<pre><code>curl http://localhost:8900
&gt;&gt; To get started with Mimic, POST an authentication request to:
&gt;&gt; /identity/v2.0/tokens
</code></pre>

<p>You can use the command below to test authentication and see your service catalog. The service catalog contains the endpoints for other available APIs.</p>

<pre><code>curl -s -XPOST -d '{"auth":{"RAX-KSKEY:apiKeyCredentials":{"username":"mimic","apiKey":"12345"}}}' http://localhost:8900/identity/v2.0/tokens | python -m json.tool
</code></pre>

<p>In order to use Mimic with most other projects you just need to override the Authentication Endpoint. In many projects, including the <a href="https://wiki.openstack.org/wiki/OpenStackClient">OpenStack Client CLI</a> or the <a href="https://github.com/openstack/python-keystoneclient/">OpenStack Keystone client</a> you can do that by setting the <code>OS_AUTH_URL</code> environment variable or the <code>--os-auth-url</code> option. For example:</p>

<pre><code>keystone --os-username mimic --os-password 1235 --os-auth-url http://localhost:8900/identity/v2.0/ catalog
</code></pre>

<h3>
<a id="come-join-us-develop-mimic-talk-to-us-at-mimic-on-ircfreenodenet" class="anchor" href="#come-join-us-develop-mimic-talk-to-us-at-mimic-on-ircfreenodenet" aria-hidden="true"><span class="octicon octicon-link"></span></a>Come join us develop Mimic! Talk to us at ##mimic on irc.freenode.net</h3>

<h4>
<a id="build-status" class="anchor" href="#build-status" aria-hidden="true"><span class="octicon octicon-link"></span></a>Build status:</h4>

<p><a href="https://travis-ci.org/rackerlabs/mimic"><img src="https://travis-ci.org/rackerlabs/mimic.svg?branch=master" alt="Build Status"></a></p>

<p><a href="https://coveralls.io/r/rackerlabs/mimic"><img src="https://coveralls.io/repos/rackerlabs/mimic/badge.png" alt="Coverage Status"></a></p>

<h2>
<a id="compute" class="anchor" href="#compute" aria-hidden="true"><span class="octicon octicon-link"></span></a>Compute</h2>

<h4>
<a id="calls-supported" class="anchor" href="#calls-supported" aria-hidden="true"><span class="octicon octicon-link"></span></a>Calls supported:</h4>

<p><a href="https://github.com/rackerlabs/mimic/blob/master/mimic/rest/nova_api.py">https://github.com/rackerlabs/mimic/blob/master/mimic/rest/nova_api.py</a></p>

<ol>
<li>LIST servers - Lists servers on the tenant, in mimic</li>
<li>POST server - Creates a server in mimic <em>(look at the 'Errors or unusual behaviors supported for compute' below)</em>
</li>
<li>GET server - Returns the server, if it exists in mimic else returns a 404</li>
<li>DELETE server - Deletes the server, if it exists in mimic else returns 404</li>
<li>LIST addresses - Lists the private and public Ips for the given server. 404 if not found.</li>
<li>GET image - If the image ID is anything but what is listed in the mimic presets, <code>invalid_image_ref</code>
           returns 200. Else returns a 400.</li>
<li>GET flavor - If the flavor ID is anything but what is listed in the mimic presets, <code>invalid_flavor_ref</code>
           returns 200. Else returns a 400.</li>
<li>GET limits - Returns only the absolute limits for compute</li>
</ol>

<h4>
<a id="errors-or-unusual-behaviors-supported-for-compute" class="anchor" href="#errors-or-unusual-behaviors-supported-for-compute" aria-hidden="true"><span class="octicon octicon-link"></span></a>Errors or unusual behaviors supported for compute:</h4>

<p>Based on the metadata (<a href="https://github.com/rackerlabs/mimic/blob/master/mimic/canned_responses/mimic_presets.py">mimic_presets</a>) provided when a server is being created, a server can be made to behave as follows:</p>

<ul>
<li>Fail with the given response message and response code</li>
<li>Go into an error state on creation</li>
<li>Remain in building state for the specified amount of time</li>
<li>Fails to delete the server, with the specified response code for the number of times specified</li>
<li>Returns 'image not found' or 'flavor not found' responses for specified IDs</li>
</ul>

<p>Eg:
Request for create server that remains in building for 120 seconds:</p>

<p><code>{
    "server" : {
        "name" : "api-test-server-1",
        "imageRef" : "3afe97b2-26dc-49c5-a2cc-a2fc8d80c001",
        "flavorRef" : "2",
        "metadata": {"server_building": 120}
    }
 }</code></p>

<h2>
<a id="rackspace-auth" class="anchor" href="#rackspace-auth" aria-hidden="true"><span class="octicon octicon-link"></span></a>Rackspace Auth</h2>

<h4>
<a id="calls-supported-1" class="anchor" href="#calls-supported-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Calls supported:</h4>

<p><a href="https://github.com/rackerlabs/mimic/blob/master/mimic/rest/auth_api.py">https://github.com/rackerlabs/mimic/blob/master/mimic/rest/auth_api.py</a></p>

<ol>
<li>Authenticate - Given a tenant id, username and password, returns the service catalog with links to compute and load balancer links within mimic, and a test token.</li>
<li>Impersonate user (Admin call) - Given a token created by mimic in the header, returns a test token for the username.</li>
<li>GET endpoints - Given token created by mimic, returns the service catalog for that user.</li>
</ol>

<h2>
<a id="cloud-load-balancer" class="anchor" href="#cloud-load-balancer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cloud Load Balancer</h2>

<h4>
<a id="calls-supported-2" class="anchor" href="#calls-supported-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Calls supported:</h4>

<p><a href="https://github.com/rackerlabs/mimic/blob/master/mimic/rest/loadbalancer_api.py">https://github.com/rackerlabs/mimic/blob/master/mimic/rest/loadbalancer_api.py</a></p>

<ol>
<li>LIST load balancers - Lists the load balancers created in mimic</li>
<li>POST load balancer - Creates a load balancer <em>(look at the 'Errors or unusual behaviors supported for cloud load balancers' below)</em>
</li>
<li>GET load balancer - Returns the load balancer if it exists, else 404</li>
<li>DELETE load balancer - Deletes the load balancer if it exists, else returns 404</li>
<li>LIST nodes - Lists the nodes on the load balancer</li>
<li>POST node - Creates a node on the load balancer</li>
<li>GET node - Returns the node if it exists, else returns 404</li>
<li>DELETE node - Deletes the node if it exists, else returns 404</li>
</ol>

<h4>
<a id="errors-or-unusual-behaviors-supported-for-cloud-load-balancers" class="anchor" href="#errors-or-unusual-behaviors-supported-for-cloud-load-balancers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Errors or unusual behaviors supported for cloud load balancers:</h4>

<p>Based on key and value of the metadata (<a href="https://github.com/rackerlabs/mimic/blob/master/mimic/canned_responses/mimic_presets.py">mimic_presets</a>) provided when a load balancer is being created, a load balancer can be made to behave as follows:</p>

<ul>
<li>Remain in 'BUILD' state for the specified amount of time</li>
<li>Load balancer goes into 'PENDING-UPDATE' state on every add/delete node for the specified amout of time</li>
<li>Load balancer goes into 'PENDING-DELETE' state on delete load balancer for the specified amout of time</li>
<li>Load balancer goes into an error state on creation</li>
</ul>

<p>Eg:
Request for create load balancer that is expected to go into 'PENDING-UPDATE' state on every add/delete
node, for 20 seconds:</p>

<p><code>{"loadBalancer": {"name": "a-new-loadbalancer2", "protocol": "HTTP", "virtualIps": [{"type": "PUBLIC"}], "metadata": [{"key": "lb_pending_update", "value": 20}], "nodes": []}}</code></p>

<h2>
<a id="mimic-control-apis" class="anchor" href="#mimic-control-apis" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mimic Control APIs</h2>

<p>When any of Mimic's included plugins schedule a timeout, you will need to cause
Mimic's internal clock to advance for any of those timeouts to fire.</p>

<p>You can do this with the <code>tick</code> endpoint, like so:</p>

<pre><code>curl -s -XPOST -d '{"amount": 1.0}' http://localhost:8900/mimic/v1.1/tick | python -m json.tool
</code></pre>

<p>which should result in output like this:</p>

<pre><code>{
    "advanced": 1.0,
    "now": "1970-01-01T00:00:04.000000Z"
}
</code></pre>

<p>Note that Mimic begins its timekeeping when all time began, in 1970.
If you would prefer to advance Mimic to something resembling the present day instead, a command like this right after Mimic starts up will do that:</p>

<pre><code>curl -s -XPOST -d '{"amount": '"$(date +%s)"'}' http://localhost:8900/mimic/v1.1/tick | python -m json.tool
</code></pre>

<h2>
<a id="mimic-does-not" class="anchor" href="#mimic-does-not" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mimic does not:</h2>

<ul>
<li>support XML</li>
<li>validate the auth token</li>
</ul>

<h2>
<a id="running-mimic-on-a-cloud-server" class="anchor" href="#running-mimic-on-a-cloud-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running Mimic on a cloud server</h2>

<ol>
<li>create a cloud server with an image that by default comes with python 2.7 (eg: ubuntu 12.04) and ssh into it</li>
<li><code>git clone https://github.com/rackerlabs/mimic.git</code></li>
<li>
<code>pip install -r requirements.txt</code> from within the mimic folder (if there is a gcc error, <code>apt-get install python-dev</code>)</li>
<li>cd into mimic or add the mimic to the PYTHONPATH and run <code>twistd -n mimic</code>
</li>
</ol>

<h2>
<a id="running-mimic-on-docker" class="anchor" href="#running-mimic-on-docker" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running Mimic on Docker</h2>

<p>The repository root has a <code>Dockerfile</code> that does what you want. It exposes Mimic on port 8900 by default.</p>

<p>To play around with Mimic locally, try:</p>

<pre><code>docker build -t mimic . &amp;&amp; docker run --restart=no --rm=true -p 8900:8900 mimic
</code></pre>

<p>This will expose Mimic on port 8900, so you can access it directly from the host. The default port exposure is intended for communication between containers; see the Docker documentation for more information. If you're using <code>boot2docker</code>, run <code>boot2docker ip</code> to find the right IP.</p>
      </section>
    </div>

    
  </body>
</html>